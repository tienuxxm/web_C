{"ast":null,"code":"import _defineProperty from\"D:/Javascript/React/order-purchasing/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"D:/Javascript/React/order-purchasing/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"D:/Javascript/React/order-purchasing/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Javascript/React/order-purchasing/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/Javascript/React/order-purchasing/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{memo,useEffect,useState,useRef}from'react';import{useParams,useNavigate}from'react-router-dom';import{Panel}from'primereact/panel';import{Toast}from'primereact/toast';import{DataTable}from'primereact/datatable';import{Column}from'primereact/column';import{getApi,postApiv1}from'../../../api';import{InputText}from'primereact/inputtext';import Form from'./form';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function MergeOrder(){var _useParams=useParams(),document=_useParams.document;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),item=_useState2[0],setItem=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),inputs=_useState4[0],setInputs=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),globalFilter=_useState6[0],setGlobalFilter=_useState6[1];var navigate=useNavigate();var toast=useRef(null);useEffect(function(){var fetchItem=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getApi(\"merge-header/detail/\".concat(document));case 3:result=_context.sent;setItem(result);if(result.length>0){setInputs({shipment:result[0].ShipmentDate});}else{navigate(\"/supply/merge\");}_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.error(\"Lỗi khi gọi API Item:\",_context.t0);case 11:case\"end\":return _context.stop();}},_callee,null,[[0,8]]);}));return function fetchItem(){return _ref.apply(this,arguments);};}();fetchItem();},[document,navigate]);/* Lấy dữ liệu từ input */var onChange=function onChange(event){var name=event.target.name;var value=event.target.value;setInputs(function(values){return _objectSpread(_objectSpread({},values),{},_defineProperty({},name,value));});};/* Lưu & gửi duyệt */var handeModalApproval=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var formData,alertFunc;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:alertFunc=function _alertFunc(){navigate(\"/supply/merge\");};if(inputs.shipment){_context2.next=3;break;}return _context2.abrupt(\"return\",toast.current.show({severity:\"error\",summary:\"Error\",detail:\"Vui lòng chọn ngày dự kiến\",life:3000}));case 3:if(!(item.length===0)){_context2.next=5;break;}return _context2.abrupt(\"return\",toast.current.show({severity:\"error\",summary:\"Error\",detail:\"Không có dữ liệu để gửi duyệt\",life:3000}));case 5:_context2.prev=5;formData=new FormData();formData.append('document',document);formData.append('shipment',inputs.shipment);_context2.next=11;return postApiv1(\"merge-header/approval\",formData);case 11:toast.current.show({severity:\"success\",summary:\"Success\",detail:\"Gửi duyệt thành công\",life:3000});_context2.next=17;break;case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](5);toast.current.show({severity:\"error\",summary:\"Error\",detail:\"Lỗi duyệt đơn\",life:3000});case 17:setTimeout(alertFunc,1000);case 18:case\"end\":return _context2.stop();}},_callee2,null,[[5,14]]);}));return function handeModalApproval(){return _ref2.apply(this,arguments);};}();var renderHeader=function renderHeader(){return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-content-between\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"p-input-icon-left\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"pi pi-search\"}),/*#__PURE__*/_jsx(InputText,{style:styles.InputText,type:\"search\",onInput:function onInput(e){return setGlobalFilter(e.target.value);},placeholder:\"Search...\"})]})});};return/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsxs(Panel,{style:styles.header,header:\"Chi ti\\u1EBFt g\\u1ED9p \\u0111\\u01A1n h\\xE0ng\",children:[/*#__PURE__*/_jsx(Form,{item:item,document:document,inputs:inputs,onChange:onChange,handeModalApproval:handeModalApproval}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(DataTable,{value:item,paginator:true,showGridlines:true,rows:25,globalFilter:globalFilter,header:renderHeader(),emptyMessage:\"Kh\\xF4ng c\\xF3 d\\u1EEF li\\u1EC7u\",style:styles.dataTable,children:[/*#__PURE__*/_jsx(Column,{field:\"ID\",hidden:true}),/*#__PURE__*/_jsx(Column,{field:\"ItemCode\",header:\"M\\xE3 s\\u1EA3n ph\\u1EA9m\",sortable:true,style:{width:'10%'}}),/*#__PURE__*/_jsx(Column,{field:\"Variant\",header:\"M\\xE3 m\\xE0u\",sortable:true,style:{width:'5%'}}),/*#__PURE__*/_jsx(Column,{field:\"ItemName\",header:\"T\\xEAn s\\u1EA3n ph\\u1EA9m\",sortable:true,style:{width:'65%'}}),/*#__PURE__*/_jsx(Column,{field:\"Unit\",header:\"\\u0110VT\",sortable:true,style:{width:'10%'}}),/*#__PURE__*/_jsx(Column,{field:\"Quantity\",header:\"S\\u1ED1 l\\u01B0\\u1EE3ng\",sortable:true,style:{width:'20%'}})]})]}),/*#__PURE__*/_jsx(Toast,{ref:toast})]});}export default/*#__PURE__*/memo(MergeOrder);var styles={header:{fontFamily:\"Times New Roman\"},InputText:{fontFamily:\"Times New Roman\"},dataTable:{fontFamily:\"Times New Roman\"},title:{textAlign:\"center\",color:\"red\",padding:\"10px\",fontFamily:\"Times New Roman\"},margin_top:{marginTop:\"20px\",fontFamily:\"Times New Roman\",marginBottom:\"20px\"}};","map":{"version":3,"names":["memo","useEffect","useState","useRef","useParams","useNavigate","Panel","Toast","DataTable","Column","getApi","postApiv1","InputText","Form","MergeOrder","document","item","setItem","inputs","setInputs","globalFilter","setGlobalFilter","navigate","toast","fetchItem","result","length","shipment","ShipmentDate","console","error","onChange","event","name","target","value","values","handeModalApproval","alertFunc","current","show","severity","summary","detail","life","formData","FormData","append","setTimeout","renderHeader","styles","e","header","dataTable","width","fontFamily","title","textAlign","color","padding","margin_top","marginTop","marginBottom"],"sources":["D:/Javascript/React/order-purchasing/src/pages/Supply/MergeOrder/index.js"],"sourcesContent":["import { memo, useEffect, useState, useRef } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { Panel } from 'primereact/panel';\r\nimport { Toast } from 'primereact/toast';\r\nimport { DataTable } from 'primereact/datatable';\r\nimport { Column } from 'primereact/column';\r\nimport { getApi, postApiv1 } from '../../../api';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport Form from './form';\r\n\r\nfunction MergeOrder() {\r\n  const { document } = useParams(); \r\n  const [item, setItem] = useState([]);\r\n  const [inputs, setInputs] = useState({});\r\n  const [globalFilter, setGlobalFilter] = useState(null);\r\n  const navigate = useNavigate();\r\n  const toast = useRef(null);\r\n  \r\n  useEffect(() => {\r\n    const fetchItem = async () => {\r\n      try {\r\n        const result = await getApi(`merge-header/detail/${document}`);\r\n        setItem(result);\r\n        if (result.length > 0) {\r\n          setInputs({\r\n            shipment: result[0].ShipmentDate,\r\n          });\r\n        } else {\r\n          navigate(`/supply/merge`);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Lỗi khi gọi API Item:\", error);\r\n      }\r\n    };\r\n    fetchItem();\r\n  }, [document, navigate]);\r\n\r\n  /* Lấy dữ liệu từ input */\r\n  const onChange = (event) => {\r\n    const name = event.target.name;\r\n    const value = event.target.value;\r\n    setInputs(values => ({...values, [name]: value}));\r\n  }\r\n\r\n  /* Lưu & gửi duyệt */\r\n  const handeModalApproval = async () => {\r\n    if (!inputs.shipment) {\r\n      return toast.current.show({severity: \"error\", summary: \"Error\", detail: \"Vui lòng chọn ngày dự kiến\", life: 3000});\r\n    }\r\n    if (item.length === 0) {\r\n      return toast.current.show({severity: \"error\", summary: \"Error\", detail: \"Không có dữ liệu để gửi duyệt\", life: 3000});\r\n    }\r\n    try {\r\n      let formData = new FormData(); \r\n      formData.append('document', document);\r\n      formData.append('shipment', inputs.shipment);\r\n      await postApiv1(\"merge-header/approval\", formData);\r\n      toast.current.show({severity:\"success\", summary: \"Success\", detail:\"Gửi duyệt thành công\", life: 3000});\r\n    } catch (error) {\r\n      toast.current.show({severity: \"error\", summary: \"Error\", detail: \"Lỗi duyệt đơn\", life: 3000});\r\n    }\r\n    setTimeout(alertFunc, 1000);\r\n    function alertFunc() { \r\n      navigate(`/supply/merge`);\r\n    }\r\n  }\r\n\r\n  const renderHeader = () => {\r\n    return (<div className=\"flex justify-content-between\">\r\n              <span className=\"p-input-icon-left\">\r\n                <i className=\"pi pi-search\" />\r\n                <InputText style={styles.InputText} type=\"search\" onInput={(e) => setGlobalFilter(e.target.value)} placeholder=\"Search...\" />\r\n              </span>\r\n            </div>);\r\n  };\r\n\r\n  return ( \r\n    <div className=\"row\">\r\n      <Panel style={styles.header} header=\"Chi tiết gộp đơn hàng\">\r\n        <Form item = {item} \r\n              document = {document} \r\n              inputs = {inputs} \r\n              onChange = {onChange} \r\n              handeModalApproval = {handeModalApproval}/>\r\n        <br/>\r\n        <DataTable value={item} paginator showGridlines rows={25} \r\n                   globalFilter={globalFilter} header={renderHeader()}\r\n                   emptyMessage=\"Không có dữ liệu\" style={styles.dataTable}>\r\n          <Column field=\"ID\" hidden></Column>\r\n          <Column field=\"ItemCode\" header=\"Mã sản phẩm\" sortable style={{ width: '10%' }}></Column>\r\n          <Column field=\"Variant\" header=\"Mã màu\" sortable style={{ width: '5%' }}></Column>\r\n          <Column field=\"ItemName\" header=\"Tên sản phẩm\" sortable style={{ width: '65%' }}></Column>\r\n          <Column field=\"Unit\" header=\"ĐVT\" sortable style={{ width: '10%' }}></Column>\r\n          <Column field=\"Quantity\" header=\"Số lượng\" sortable style={{ width: '20%' }}></Column>\r\n                  {/* <Column field=\"Action\" header=\"Thao tác\" body={activityBodyTemplate} style={{ width: '10%' }}></Column> */}\r\n        </DataTable>\r\n      </Panel>\r\n      <Toast ref = {toast}/>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default memo(MergeOrder);\r\nconst styles = {\r\n  header: {fontFamily:\"Times New Roman\"},\r\n  InputText: {fontFamily:\"Times New Roman\"},\r\n  dataTable: {fontFamily:\"Times New Roman\"},\r\n  title:{\r\n    textAlign:\"center\",\r\n    color:\"red\",\r\n    padding:\"10px\",\r\n    fontFamily:\"Times New Roman\"\r\n  },\r\n  margin_top:{\r\n    marginTop:\"20px\",\r\n    fontFamily:\"Times New Roman\",\r\n    marginBottom:\"20px\",\r\n  },\r\n}\r\n "],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}